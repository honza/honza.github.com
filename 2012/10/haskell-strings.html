<!doctype html>
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="description" content="Thoughts on web programming, open source hacking and the like. Honza Pokorny is a web developer in Halifax, Canada" >
  <meta name="viewport" content="width=550, maximum-scale=1.0" />
  <meta name="readability-verification" content="cXteMUVfc4F4DwUmDFS563269y9HLgfxK34fvdMC"/>
  <title>Haskell Strings - Honza Pokorny</title>
  <link rel="stylesheet" href="/media/screen.css" type="text/css" />
  <link rel="alternate" type="application/atom+xml" title="News-Feed" href="http://honza.ca/atom.xml" />
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-4330851-12']);
        _gaq.push(['_trackPageview']);

        (function(){
         var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
         ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>    

    <script type="text/javascript">
    /* <![CDATA[ */
        (function() {
            var s = document.createElement('script'), t = document.getElementsByTagName('script')[0];
            
            s.type = 'text/javascript';
            s.async = true;
            s.src = 'http://api.flattr.com/js/0.6/load.js?mode=auto'
            
            t.parentNode.insertBefore(s, t);
        })();
    /* ]]> */
    </script>
        
</head>
<body>

    <div id="wrap">
        <div id="banner" class="body">
            <h1><a href="/">Honza Pokorny</a></h1>
        </div>
        <p>Thoughts on web programming and the world of technology</p>
        

<p class="article_date date">
    October 24, 2012
</p>

<div id="content">
    <div class="section" id="haskell-strings">
<h3>Haskell&nbsp;Strings</h3>
<p>It continues to amaze me how bad Haskell is at processing strings.  One of the
reasons I wanted to learn Haskell was to be able to write short,
dynamic-language-like programs that execute fast once compiled.  Somehow
rather, Haskell has failed to deliver on its promise of <em>bare metal</em> speed.  I
mostly write scripts and utilities meant to run on my machine&#8212;these scripts
mostly process text.  Read a &#xFB01;le, parse it and spit something&nbsp;out.</p>
<div class="section" id="example">
<h4>Example</h4>
<p>Let&#8217;s build a simple program that will show what I&#8217;m talking&nbsp;about.</p>
<ul class="simple">
<li>Read a &#xFB01;le called <tt class="docutils literal">&#xFB01;le</tt> which contains&nbsp;prose</li>
<li>Capitalize every word in that body of&nbsp;text</li>
<li>Print the result to&nbsp;stdout</li>
</ul>
<p>We will be testing our programs with a &#xFB01;le with about 1.2 million lines of
Lorem Ipsum.  This &#xFB01;le is around&nbsp;<span class="caps">75MB</span>.</p>
<p>Here is attemp number one.  This is really simple&nbsp;Haskell.</p>
<div class="highlight"><pre><span class="c1">-- Normal.hs</span>

<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>
<span class="kr">import</span> <span class="nn">Data.Char</span>

<span class="nf">convert</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">convert</span> <span class="ow">=</span> <span class="n">unlines</span> <span class="o">.</span> <span class="p">(</span><span class="n">map</span> <span class="n">convertLine</span><span class="p">)</span> <span class="o">.</span> <span class="n">lines</span>

<span class="nf">convertLine</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">convertLine</span> <span class="ow">=</span> <span class="n">unwords</span> <span class="o">.</span> <span class="p">(</span><span class="n">map</span> <span class="n">convertWord</span><span class="p">)</span> <span class="o">.</span> <span class="n">words</span>

<span class="nf">convertWord</span> <span class="ow">::</span> <span class="kt">String</span> <span class="ow">-&gt;</span> <span class="kt">String</span>
<span class="nf">convertWord</span> <span class="n">s</span> <span class="ow">=</span> <span class="p">(</span><span class="n">toUpper</span> <span class="p">(</span><span class="n">head</span> <span class="n">s</span><span class="p">))</span><span class="kt">:</span><span class="p">(</span><span class="n">tail</span> <span class="n">s</span><span class="p">)</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
    <span class="n">name</span> <span class="ow">&lt;-</span> <span class="n">readFile</span> <span class="s">&quot;&#xFB01;le&quot;</span>
    <span class="n">putStr</span> <span class="o">$</span> <span class="n">convert</span> <span class="n">name</span>
</pre></div>
<p>Compile and execute&nbsp;with</p>
<pre class="literal-block">
ghc -O2 -o normal Normal.hs
time ./normal &gt; /dev/null
</pre>
<p>This takes about 17 seconds.  Let&#8217;s see if we can do any better.  When you
complain about Strings in Haskell being slow on some neckbeard forum, people
will tell you to use <tt class="docutils literal">Data.Text</tt>.</p>
<div class="highlight"><pre><span class="c1">-- Main.hs</span>

<span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Data.Char</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.Text</span> <span class="k">as</span> <span class="n">T</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.Text.<span class="caps">IO</span></span> <span class="k">as</span> <span class="n">X</span>

<span class="nf">convert</span> <span class="ow">::</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span> <span class="ow">-&gt;</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="nf">convert</span> <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">unlines</span> <span class="o">.</span> <span class="p">(</span><span class="n">map</span> <span class="n">convertLine</span><span class="p">)</span> <span class="o">.</span> <span class="kt">T</span><span class="o">.</span><span class="n">lines</span>

<span class="nf">convertLine</span> <span class="ow">::</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span> <span class="ow">-&gt;</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="nf">convertLine</span> <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">unwords</span> <span class="o">.</span> <span class="p">(</span><span class="n">map</span> <span class="n">convertWord</span><span class="p">)</span> <span class="o">.</span> <span class="kt">T</span><span class="o">.</span><span class="n">words</span>

<span class="nf">convertWord</span> <span class="ow">::</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span> <span class="ow">-&gt;</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="nf">convertWord</span> <span class="n">s</span> <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">cons</span> <span class="p">(</span><span class="n">toUpper</span> <span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="n">head</span> <span class="n">s</span><span class="p">))</span> <span class="p">(</span><span class="kt">T</span><span class="o">.</span><span class="n">tail</span> <span class="n">s</span><span class="p">)</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
    <span class="n">name</span> <span class="ow">&lt;-</span> <span class="kt">X</span><span class="o">.</span><span class="n">readFile</span> <span class="s">&quot;&#xFB01;le&quot;</span>
    <span class="kt">X</span><span class="o">.</span><span class="n">putStr</span> <span class="o">$</span> <span class="n">convert</span> <span class="n">name</span>
</pre></div>
<p>This is mostly the same as above.  Instead of using the <tt class="docutils literal">String</tt> type to work
with text, we use the <tt class="docutils literal">Data.Text.Text</tt> type.</p>
<pre class="literal-block">
ghc -O2 -o main Main.hs
time ./main &gt; /dev/null
</pre>
<p>How did it do?  One entire minute, that&#8217;s 5 times slower.  And it uses obscene
amounts of memory (around <span class="caps">600MB</span> on my machine).  Let&#8217;s use lazy <span class="caps">IO</span> when reading
the &#xFB01;le, maybe it will&nbsp;improve.</p>
<div class="highlight"><pre><span class="c1">-- change this</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.Text</span> <span class="k">as</span> <span class="n">T</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.Text.<span class="caps">IO</span></span> <span class="k">as</span> <span class="n">X</span>

<span class="c1">-- to this</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.Text.Lazy</span> <span class="k">as</span> <span class="n">T</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.Text.Lazy.<span class="caps">IO</span></span> <span class="k">as</span> <span class="n">X</span>
</pre></div>
<p>This clocks in at 27 seconds.  Much better than the non-lazy version.  Next
thing to try is to ignore unicode and go for the ultimate, bare-metal speed.
Let&#8217;s use <tt class="docutils literal">ByteString</tt> instead of <tt class="docutils literal">Text</tt>.</p>
<div class="highlight"><pre><span class="kr">module</span> <span class="nn">Byte</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Data.Char</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.ByteString</span> <span class="k">as</span> <span class="n">B</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.ByteString.Char8</span> <span class="k">as</span> <span class="n">C</span>

<span class="nf">convert</span> <span class="ow">::</span> <span class="kt">B</span><span class="o">.</span><span class="kt">ByteString</span> <span class="ow">-&gt;</span> <span class="kt">B</span><span class="o">.</span><span class="kt">ByteString</span>
<span class="nf">convert</span> <span class="ow">=</span> <span class="kt">C</span><span class="o">.</span><span class="n">unlines</span> <span class="o">.</span> <span class="p">(</span><span class="n">map</span> <span class="n">convertLine</span><span class="p">)</span> <span class="o">.</span> <span class="kt">C</span><span class="o">.</span><span class="n">lines</span>

<span class="nf">convertLine</span> <span class="ow">::</span> <span class="kt">B</span><span class="o">.</span><span class="kt">ByteString</span> <span class="ow">-&gt;</span> <span class="kt">B</span><span class="o">.</span><span class="kt">ByteString</span>
<span class="nf">convertLine</span> <span class="ow">=</span> <span class="kt">C</span><span class="o">.</span><span class="n">unwords</span> <span class="o">.</span> <span class="p">(</span><span class="n">map</span> <span class="n">convertWord</span><span class="p">)</span> <span class="o">.</span> <span class="kt">C</span><span class="o">.</span><span class="n">words</span>

<span class="nf">convertWord</span> <span class="ow">::</span> <span class="kt">B</span><span class="o">.</span><span class="kt">ByteString</span> <span class="ow">-&gt;</span> <span class="kt">B</span><span class="o">.</span><span class="kt">ByteString</span>
<span class="nf">convertWord</span> <span class="n">s</span> <span class="ow">=</span> <span class="kt">C</span><span class="o">.</span><span class="n">cons</span> <span class="p">(</span><span class="n">toUpper</span> <span class="p">(</span><span class="kt">C</span><span class="o">.</span><span class="n">head</span> <span class="n">s</span><span class="p">))</span> <span class="p">(</span><span class="kt">C</span><span class="o">.</span><span class="n">tail</span> <span class="n">s</span><span class="p">)</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
    <span class="n">name</span> <span class="ow">&lt;-</span> <span class="kt">B</span><span class="o">.</span><span class="n">readFile</span> <span class="s">&quot;&#xFB01;le&quot;</span>
    <span class="kt">B</span><span class="o">.</span><span class="n">putStr</span> <span class="o">$</span> <span class="n">convert</span> <span class="n">name</span>
</pre></div>
<p>Hm, not that much better.  27 seconds.  That&#8217;s about as good as the lazy
version when using <tt class="docutils literal">Text</tt>.  Let&#8217;s see if we can squeeze more perfomance out
of this with a lazy <tt class="docutils literal">ByteString</tt></p>
<div class="highlight"><pre><span class="c1">-- change this</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.ByteString</span> <span class="k">as</span> <span class="n">B</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.ByteString.Char8</span> <span class="k">as</span> <span class="n">C</span>

<span class="c1">-- to this</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.ByteString.Lazy</span> <span class="k">as</span> <span class="n">B</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.ByteString.Lazy.Char8</span> <span class="k">as</span> <span class="n">C</span>
</pre></div>
<p>This takes about 10 seconds.  Awesome.  This is the best I can do with Haskell.
10 seconds to process 1.2 million lines of text.  I guess that&#8217;s not too&nbsp;bad.</p>
<p><strong><span class="caps">EDIT</span></strong>: Someone <a class="reference external" href="http://www.reddit.com/r/haskell/comments/120h6i/why_is_this_simple_text_processing_program_so/c6r6rm1">pointed out on Reddit</a> that this whole thing can be
accomplished as a simple one-liner.  This is actually a pretty elegant&nbsp;solution.</p>
<div class="highlight"><pre><span class="kr">module</span> <span class="nn">Main</span> <span class="kr">where</span>

<span class="kr">import</span> <span class="nn">Data.Char</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.Text.Lazy</span> <span class="k">as</span> <span class="n">T</span>
<span class="kr">import</span> <span class="k">quali&#xFB01;ed</span> <span class="nn">Data.Text.Lazy.<span class="caps">IO</span></span> <span class="k">as</span> <span class="n">X</span>

<span class="nf">convert</span> <span class="ow">::</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span> <span class="ow">-&gt;</span> <span class="kt">T</span><span class="o">.</span><span class="kt">Text</span>
<span class="nf">convert</span> <span class="ow">=</span> <span class="kt">T</span><span class="o">.</span><span class="n">tail</span> <span class="o">.</span> <span class="kt">T</span><span class="o">.</span><span class="n">scanl</span> <span class="p">(</span><span class="nf">\</span><span class="n">a</span> <span class="n">b</span> <span class="ow">-&gt;</span> <span class="kr">if</span> <span class="n">isSpace</span> <span class="n">a</span> <span class="kr">then</span> <span class="n">toUpper</span> <span class="n">b</span> <span class="kr">else</span> <span class="n">b</span><span class="p">)</span> <span class="sc">&#39; &#39;</span>

<span class="nf">main</span> <span class="ow">=</span> <span class="kr">do</span>
    <span class="n">name</span> <span class="ow">&lt;-</span> <span class="kt">X</span><span class="o">.</span><span class="n">readFile</span> <span class="s">&quot;&#xFB01;le&quot;</span>
    <span class="kt">X</span><span class="o">.</span><span class="n">putStr</span> <span class="o">$</span> <span class="n">convert</span> <span class="n">name</span>
</pre></div>
<p>This clocks in at 8.5 seconds.  Not bad at&nbsp;all.</p>
</div>
<div class="section" id="python">
<h4>Python</h4>
<p>Let&#8217;s try this in&nbsp;Python</p>
<div class="highlight"><pre><span class="k">def</span> <span class="nf">process</span><span class="p">(</span><span class="n">data</span><span class="p">):</span>
    <span class="n">lines</span> <span class="o">=</span> <span class="n">data</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39;</span><span class="se">\n</span><span class="s">&#39;</span><span class="p">)</span>
    <span class="k">return</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="o">.</span><span class="n">join</span><span class="p">([</span><span class="n">process_line</span><span class="p">(</span><span class="n">line</span><span class="p">)</span> <span class="k">for</span> <span class="n">line</span> <span class="ow">in</span> <span class="n">lines</span><span class="p">])</span>


<span class="k">def</span> <span class="nf">process_line</span><span class="p">(</span><span class="n">line</span><span class="p">):</span>
    <span class="n">words</span> <span class="o">=</span> <span class="n">line</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s">&#39; &#39;</span><span class="p">)</span>
    <span class="n">new</span> <span class="o">=</span> <span class="p">[</span><span class="n">w</span><span class="o">.</span><span class="n">capitalize</span><span class="p">()</span> <span class="k">for</span> <span class="n">w</span> <span class="ow">in</span> <span class="n">words</span><span class="p">]</span>
    <span class="k">return</span> <span class="s">&quot; &quot;</span><span class="o">.</span><span class="n">join</span><span class="p">(</span><span class="n">new</span><span class="p">)</span>


<span class="k">if</span> <span class="n">__name__</span> <span class="o">==</span> <span class="s">&#39;__main__&#39;</span><span class="p">:</span>
    <span class="n">data</span> <span class="o">=</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;&#xFB01;le&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span>
    <span class="k">print</span> <span class="n">process</span><span class="p">(</span><span class="n">data</span><span class="p">)</span>
</pre></div>
<p>Execute&nbsp;with</p>
<pre class="literal-block">
$ time python main.py &gt; /dev/null
</pre>
<p>Six seconds!  Six!  How can a dynamic language be so much faster than compiled&nbsp;Haskell?</p>
<p><strong><span class="caps">EDIT</span> 4</strong>: There has been some discussion on Reddit about being able to
accomplish this task in only one line in Haskell.  It&#8217;s actually possible in
Python,&nbsp;too.</p>
<div class="highlight"><pre><span class="k">print</span> <span class="nb">open</span><span class="p">(</span><span class="s">&#39;&#xFB01;le&#39;</span><span class="p">)</span><span class="o">.</span><span class="n">read</span><span class="p">()</span><span class="o">.</span><span class="n">title</span><span class="p">()</span>
</pre></div>
<p>This clocks in at 2&nbsp;seconds.</p>
</div>
<div class="section" id="javascript-and-v8">
<h4>Javascript and&nbsp;V8</h4>
<div class="highlight"><pre><span class="c1">// main.js</span>

<span class="kd">var</span> <span class="nx">fs</span> <span class="o">=</span> <span class="nx">require</span><span class="p">(</span><span class="s1">&#39;fs&#39;</span><span class="p">);</span>

<span class="kd">function</span> <span class="nx">capitalize</span><span class="p">(</span><span class="nx">string</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">return</span> <span class="nx">string</span><span class="p">.</span><span class="nx">charAt</span><span class="p">(</span><span class="mi">0</span><span class="p">).</span><span class="nx">toUpperCase</span><span class="p">()</span> <span class="o">+</span> <span class="nx">string</span><span class="p">.</span><span class="nx">slice</span><span class="p">(</span><span class="mi">1</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">processLine</span><span class="p">(</span><span class="nx">line</span><span class="p">)</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">words</span> <span class="o">=</span> <span class="nx">line</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">words</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">words</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">capitalize</span><span class="p">(</span><span class="nx">words</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">words</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s1">&#39; &#39;</span><span class="p">);</span>
<span class="p">}</span>

<span class="kd">function</span> <span class="nx">run</span><span class="p">()</span> <span class="p">{</span>
    <span class="kd">var</span> <span class="nx">data</span> <span class="o">=</span> <span class="nx">fs</span><span class="p">.</span><span class="nx">readFileSync</span><span class="p">(</span><span class="s1">&#39;&#xFB01;le&#39;</span><span class="p">,</span> <span class="s1">&#39;utf-8&#39;</span><span class="p">);</span>
    <span class="kd">var</span> <span class="nx">lines</span> <span class="o">=</span> <span class="nx">data</span><span class="p">.</span><span class="nx">split</span><span class="p">(</span><span class="s1">&#39;\n&#39;</span><span class="p">);</span>

    <span class="k">for</span> <span class="p">(</span><span class="kd">var</span> <span class="nx">i</span><span class="o">=</span><span class="mi">0</span><span class="p">;</span> <span class="nx">i</span> <span class="o">&lt;</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">length</span><span class="p">;</span> <span class="nx">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
        <span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">]</span> <span class="o">=</span> <span class="nx">processLine</span><span class="p">(</span><span class="nx">lines</span><span class="p">[</span><span class="nx">i</span><span class="p">]);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="nx">lines</span><span class="p">.</span><span class="nx">join</span><span class="p">(</span><span class="s2">&quot;\n&quot;</span><span class="p">);</span>
<span class="p">}</span>

<span class="nx">console</span><span class="p">.</span><span class="nx">log</span><span class="p">(</span><span class="nx">run</span><span class="p">());</span>
</pre></div>
<p>Execute it&nbsp;with:</p>
<pre class="literal-block">
$ time node main.js &gt; /dev/null
</pre>
<p>Wait for it!  4.5 seconds.  I have no&nbsp;words.</p>
</div>
<div class="section" id="how-about-go">
<h4>How about&nbsp;Go?</h4>
<p><strong><span class="caps">EDIT</span> 3</strong>: (Add this section.  Looks like this post is turning into a language
shootout, le&nbsp;sigh).</p>
<div class="highlight"><pre><span class="k">package</span> <span class="n">main</span>

<span class="k">import</span> <span class="p">(</span>
    <span class="s">&quot;fmt&quot;</span>
    <span class="s">&quot;io/ioutil&quot;</span>
    <span class="s">&quot;bytes&quot;</span>
<span class="p">)</span>

<span class="k">func</span> <span class="n">main</span><span class="p">()</span> <span class="p">{</span>
    <span class="n">body</span><span class="p">,</span> <span class="n">_</span> <span class="p">:=</span> <span class="n">ioutil</span><span class="p">.</span><span class="n">ReadFile</span><span class="p">(</span><span class="s">&quot;&#xFB01;le&quot;</span><span class="p">)</span>
    <span class="n">result</span> <span class="p">:=</span> <span class="n">bytes</span><span class="p">.</span><span class="n">Title</span><span class="p">(</span><span class="n">body</span><span class="p">)</span>
    <span class="n">fmt</span><span class="p">.</span><span class="n">Printf</span><span class="p">(</span><span class="s">&quot;%s&quot;</span><span class="p">,</span> <span class="n">result</span><span class="p">)</span>
<span class="p">}</span>
</pre></div>
<p>Put this into <tt class="docutils literal">title.go</tt>, compile and run&nbsp;with</p>
<pre class="literal-block">
$ go build title.go
$ time ./title &gt; /dev/null
</pre>
<p>This is around 2 seconds.  Pretty crazy performance.  Only twice the time
compared to&nbsp;C.</p>
</div>
<div class="section" id="how-about-c">
<h4>How about&nbsp;C?</h4>
<p><strong><span class="caps">EDIT</span> 2</strong>: (Add this&nbsp;section)</p>
<p><a class="reference external" href="https://twitter.com/andrewstwrt">Andrew Stewart</a> has graciously written a C version of this program.  Like he
<a class="reference external" href="https://twitter.com/andrewstwrt/status/261282584263286784">said</a>, you should do all of your scripting in&nbsp;C.</p>
<div class="highlight"><pre><span class="c1">// script.c</span>

<span class="cp">#include &lt;stdio.h&gt;</span>
<span class="cp">#include &lt;string.h&gt;</span>

<span class="kt">int</span> <span class="nf">main</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="p">{</span>
    <span class="k">static</span> <span class="k">const</span> <span class="kt">char</span> <span class="n">&#xFB01;lename</span><span class="p">[]</span> <span class="o">=</span> <span class="s">&quot;&#xFB01;le&quot;</span><span class="p">;</span>
    <span class="kt"><span class="caps">FILE</span></span> <span class="o">*</span><span class="n">&#xFB01;le</span> <span class="o">=</span> <span class="n">fopen</span><span class="p">(</span><span class="n">&#xFB01;lename</span><span class="p">,</span> <span class="s">&quot;r&quot;</span><span class="p">);</span>

    <span class="k">if</span> <span class="p">(</span><span class="n">&#xFB01;le</span> <span class="o">!=</span> <span class="nb"><span class="caps">NULL</span></span><span class="p">)</span> <span class="p">{</span>
        <span class="kt">char</span> <span class="n">line</span><span class="p">[</span><span class="mi">1024</span><span class="p">];</span>
        <span class="k">while</span><span class="p">(</span><span class="n">fgets</span><span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="k">sizeof</span> <span class="n">line</span><span class="p">,</span> <span class="n">&#xFB01;le</span><span class="p">)</span> <span class="o">!=</span> <span class="nb"><span class="caps">NULL</span></span><span class="p">)</span> <span class="p">{</span>
        <span class="n">line</span><span class="p">[</span><span class="n">strcspn</span> <span class="p">(</span><span class="n">line</span><span class="p">,</span> <span class="s">&quot;</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">)]</span> <span class="o">=</span> <span class="sc">&#39;\0&#39;</span><span class="p">;</span>

        <span class="kt">int</span> <span class="n">lengthOfLine</span> <span class="o">=</span> <span class="n">strlen</span><span class="p">(</span><span class="n">line</span><span class="p">);</span>
        <span class="kt">int</span> <span class="n">word</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
        <span class="kt">int</span> <span class="n">i</span><span class="p">;</span>

        <span class="k">for</span> <span class="p">(</span><span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">lengthOfLine</span><span class="p">;</span> <span class="n">i</span><span class="o">++</span><span class="p">)</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="n">isalpha</span><span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]))</span> <span class="p">{</span>
            <span class="k">if</span> <span class="p">(</span><span class="o">!</span><span class="n">word</span><span class="p">)</span> <span class="p">{</span>
                <span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]</span> <span class="o">=</span> <span class="p">(</span><span class="kt">char</span><span class="p">)</span> <span class="n">toupper</span> <span class="p">(</span><span class="n">line</span><span class="p">[</span><span class="n">i</span><span class="p">]);</span>
                <span class="n">word</span> <span class="o">=</span> <span class="mi">1</span><span class="p">;</span>
            <span class="p">}</span>
            <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
            <span class="n">word</span> <span class="o">=</span> <span class="mi">0</span><span class="p">;</span>
            <span class="p">}</span>
        <span class="p">}</span>

        <span class="n">printf</span> <span class="p">(</span><span class="s">&quot;%s</span><span class="se">\n</span><span class="s">&quot;</span><span class="p">,</span> <span class="n">line</span><span class="p">);</span>
        <span class="p">}</span>

        <span class="n">fclose</span><span class="p">(</span><span class="n">&#xFB01;le</span><span class="p">);</span>
    <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">perror</span><span class="p">(</span><span class="n">&#xFB01;lename</span><span class="p">);</span>
    <span class="p">}</span>

    <span class="k">return</span> <span class="mi">0</span><span class="p">;</span>
<span class="p">}</span>
</pre></div>
<p>Compile and run this&nbsp;with:</p>
<pre class="literal-block">
$ gcc -o script script.c
$ time ./script &gt; /dev/null
</pre>
<p>Of course, this is ripping fast.  It takes about 1 second (1.05-1.15, never
below&nbsp;1).</p>
</div>
<div class="section" id="recap">
<h4>Recap</h4>
<pre class="literal-block">
Haskell - String              17s
Haskell - Text                60s
Haskell - Text (Lazy)         27s
Haskell - ByteString          27s
Haskell - ByteString (Lazy)   10s
Haskell - Text, scanl (Lazy)  8.5s

Python -                      6s
Python - One line, titl()     2s

Javascript <span class="amp">&amp;</span> V8               4.5s

Go                            2s

C                             1s
</pre>
<p>Not sure if I want to continue learning Haskell after&nbsp;this.</p>
</div>
</div>

</div>

<span class="article_buttons">
    <script src="http://platform.twitter.com/widgets.js" type="text/javascript"></script>
    <a href="http://twitter.com/share" class="twitter-share-button"
        data-url="http://honza.ca/2012/10/haskell-strings"
        data-via="_honza"
        data-text="Haskell Strings"
        data-count="none">Tweet</a>
    <a href="http://honza.ca/2012/10/haskell-strings"
        class="FlattrButton"
        rev="flattr;uid:honza;button:compact;"
        title="Haskell Strings"
        style="display:none"></a>

</span>


    </div>

</body>
</html>