<!doctype html lang="en">
<html>
<head>
  <meta http-equiv="Content-Type" content="text/html; charset=utf-8" />
  <meta name="description" content="Thoughts of an open source developer with a theology degree. Honza Pokorny is a web developer and an armchair theologian in Halifax, Canada" >
  <meta name="viewport" content="width=device-width, initial-scale=1, shrink-to-fit=no">

  <title>Deploying Django with nginx and gunicorn - Honza Pokorny</title>
  
  <meta property="og:title" content="Deploying Django with nginx and gunicorn" />
  <meta property="og:url" content="https://honza.ca/2011/05/deploying-django-with-nginx-and-gunicorn" />
  <meta property="twitter:title" content="Deploying Django with nginx and gunicorn" />
  <meta property="og:type" content="article" />
  
  <meta content='summary_large_image' name='twitter:card'>
  <meta content='@_honza' name='twitter:site'>

  <link href="https://fonts.googleapis.com/css?family=Karla:400,400i|Montserrat:700&display=swap" rel="stylesheet">

  <link rel="stylesheet" href="/media/screen.css" type="text/css" />
  <link rel="alternate" type="application/atom+xml" title="News-Feed" href="https://honza.ca/atom.xml" />
    <script type="text/javascript">
        var _gaq = _gaq || [];
        _gaq.push(['_setAccount', 'UA-4330851-12']);
        _gaq.push(['_trackPageview']);

        (function(){
         var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
         ga.src = ('https:' == document.location.protocol ? 'https://ssl' : 'http://www') + '.google-analytics.com/ga.js';
         var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
        })();

    </script>

</head>
<body>
        <div id="banner" class="container">
          <h1><a href="/">Honza Pokorny</a></h1>
          <p><em>Thoughts of an open source developer with a theology degree</em></p>
        </div>

    <div id="wrap">
        

<div id="content">
    <div class="section" id="deploying-django-with-nginx-and-gunicorn">
<h1>Deploying Django with nginx and&nbsp;gunicorn</h1>
<p>The amazing Django <a class="reference external" href="https://docs.djangoproject.com/en/1.3/howto/deployment/modwsgi/">documentation</a> recommends that you use Apache and modwsgi
to deploy your webapp. While this is certainly not bad advice, you may not want
to use Apache after all. Apache is a beast that eats up a lot of memory, is
kind of slow and can&#8217;t handle as much traffic. As a fun alternative, I would
like to talk about deploying Django on nginx using the <a class="reference external" href="http://gunicorn.org/">gunicorn</a> web&nbsp;server.</p>
<p>Just a quick note before we start: this isn&#8217;t an out-there deployment option. I
spoke to one of the gunicorn developers and was told that every django hosting
company (think ep.io) uses this&nbsp;setup.</p>
<div class="section" id="get-your-server-ready">
<h2>Get your server&nbsp;ready</h2>
<p>I use Rackspace for small, single server web apps. I created an Ubuntu 10.10
instance with <span class="caps">256MB</span> of <span class="caps">RAM</span>. Then, I created a user for my app and added my ssh
key to <tt class="docutils literal">authorized_keys</tt>. Basic&nbsp;stuff.</p>
</div>
<div class="section" id="install-nginx">
<h2>Install&nbsp;nginx</h2>
<p>Installing nginx couldn&#8217;t be simpler. Latest stable release is provided via a
ppa&nbsp;repository.</p>
<div class="highlight"><pre><span class="gp">$</span> sudo apt-get install python-software-properties -y
<span class="gp">$</span> sudo -s
<span class="gp">$</span> apt-add-repository ppa:nginx/stable
<span class="gp">$</span> apt-get update
<span class="gp">$</span> apt-get install nginx
<span class="gp">$</span> <span class="nb">exit</span>
</pre></div>
</div>
<div class="section" id="project-structure">
<h2>Project&nbsp;structure</h2>
<p>The user under which the app will run is <tt class="docutils literal">webapp</tt>, so I checkout my app in
<tt class="docutils literal">/home/webapp</tt>.</p>
<div class="highlight"><pre><span class="go">/home/webapp/app</span>
<span class="go">/home/webapp/app/static</span>
<span class="go">/home/webapp/env</span>
</pre></div>
<p>Note that I&#8217;m using <tt class="docutils literal">virtualenv</tt> to deploy this&nbsp;app.</p>
</div>
<div class="section" id="configure-nginx-and-gunicorn">
<h2>Configure nginx and&nbsp;gunicorn</h2>
<p>The following two files can be distributed with your&nbsp;project.</p>
<p>nginx.conf:</p>
<div class="highlight"><pre><span class="go">server {</span>
<span class="go">    listen 80;</span>
<span class="go">    server_name webapp.org;</span>

<span class="go">    access_log /home/webapp/access.log;</span>
<span class="go">    error_log /home/webapp/error.log;</span>

<span class="go">    location /static {</span>
<span class="go">        root /home/webapp/app;</span>
<span class="go">    }</span>

<span class="go">    location / {</span>
<span class="go">        proxy_pass http://127.0.0.1:8888;</span>
<span class="go">    }</span>
<span class="go">}</span>
</pre></div>
<p>Next, I symlinked <tt class="docutils literal">nginx.conf</tt> to the server&#8217;s <tt class="docutils literal"><span class="pre">sites-enabled</span></tt> directory.</p>
<div class="highlight"><pre><span class="gp">$</span> sudo ln -s /home/webapp/app/nginx.conf /etc/nginx/sites-enable/webapp.org
</pre></div>
<p>This sets up nginx to directly serve the applications&#8217;s static files (css, js,
etc.). Everything else is proxied to the gunicorn&nbsp;server.</p>
<p>Now gunicorn is a Python <span class="caps">HTTP</span> server. It&#8217;s super simple and effective. I
installed it into the app&#8217;s&nbsp;environment.</p>
<div class="highlight"><pre><span class="gp">$</span> <span class="o">(</span>env<span class="o">)</span> pip install gunicorn
</pre></div>
<p>gunicorn.conf.py:</p>
<div class="highlight"><pre><span class="n">bind</span> <span class="o">=</span> <span class="s">&quot;127.0.0.1:8888&quot;</span>
<span class="n">logfile</span> <span class="o">=</span> <span class="s">&quot;/home/webapp/gunicorn.log&quot;</span>
<span class="n">workers</span> <span class="o">=</span> <span class="mi">3</span>
</pre></div>
<p>That&#8217;s it! The config files are simple and easy to&nbsp;read.</p>
</div>
<div class="section" id="running">
<h2>Running</h2>
<p>I then collected all the static files into the <tt class="docutils literal">static</tt> directory:</p>
<div class="highlight"><pre><span class="gp">$</span> <span class="o">(</span>env<span class="o">)</span> python manage.py collectstatic
</pre></div>
<p>I restarted&nbsp;nginx:</p>
<div class="highlight"><pre><span class="gp">$</span> sudo /etc/init.d/nginx restart
</pre></div>
<p>And finally, I ran the <tt class="docutils literal">gunicorn</tt> server:</p>
<div class="highlight"><pre><span class="gp">$</span> <span class="o">(</span>env<span class="o">)</span> <span class="nb">cd</span> /home/webapp/app
<span class="gp">$</span> <span class="o">(</span>env<span class="o">)</span> gunicorn_django -D -c gunicorn.conf.py
</pre></div>
<p>And I was good to&nbsp;go.</p>
</div>
<div class="section" id="notes">
<h2>Notes</h2>
<p>You may have to change the permissions on the <tt class="docutils literal">static</tt> directory. Also, the
command above starts <tt class="docutils literal">gunicorn</tt> as a deamon - a better way would be to use a
monitoring service to start it. Think <tt class="docutils literal">runit</tt> or <tt class="docutils literal">supervisord</tt>. Also, I
didn&#8217;t include any database specific configurations since that&#8217;s indentical to
an Apache&nbsp;deployment.</p>
</div>
</div>

</div>

<p class="article_date date">
    This article was first published on May 30, 2011.  As you can see, there
    are no comments.  I invite you to email me with your comments, criticisms,
    and other suggestions.  Even better, write your own article as a response.
    Blogging is awesome.
</p>


    </div>

</body>
</html>