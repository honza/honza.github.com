{
    "reading_time": "2 minutes", 
    "month": "12", 
    "year": "2013", 
    "date": "December 11, 2013", 
    "slug": "masterless-saltstack", 
    "contents": "<div class=\"section\" id=\"masterless-saltstack\">\n<h1>Masterless&nbsp;Saltstack</h1>\n<p>This is a simple guide on how to use Saltstack, the configuration manager, in\nmasterless mode.  In most scenarios, you will use a Saltstack master to\ncontrol many minions.  Saltstack contains a lot of utilities to check the state\nof minions, gather information about them,&nbsp;etc.</p>\n<p>However, if you are working on a small, single-server application, Saltstack&#8217;s\nmaster-minion setup might be overkill.  You can indeed use a single&nbsp;minion.</p>\n<div class=\"section\" id=\"a-bit-of-setup-first\">\n<h2>A bit of setup&nbsp;first</h2>\n<p>Your project will need two directories for Saltstack&#8217;s&nbsp;files.</p>\n<pre class=\"literal-block\">\npillar/\nsalt/\n</pre>\n<p>The <tt class=\"docutils literal\">salt</tt> directory will contain the scripts that are responsible for\nsetting up a particular part of your server, e.g. nginx, postgresql, etc.\n<tt class=\"docutils literal\">pillar</tt> on the other hand will contain the configuration value for each\nenvironment that your app will run in.  So, you might have a <em>staging</em> and a\n<em>production</em> environment set up&nbsp;there.</p>\n<p>Each of these directories needs a <tt class=\"docutils literal\">top.sls</tt> file which is what&#8217;s loaded\nfirst.  For fun, let&#8217;s just install <tt class=\"docutils literal\">vim</tt> into a production&nbsp;environment.</p>\n<pre class=\"literal-block\">\npillar/\n    top.sls\n    production.sls\nsalt/\n    top.sls\n    vim.sls\n</pre>\n</div>\n<div class=\"section\" id=\"salt\">\n<h2>Salt</h2>\n<p>The <tt class=\"docutils literal\">salt/top.sls</tt> file will have a case-expression-like structure, matching\non hostnames of your&nbsp;app.</p>\n<div class=\"highlight\"><pre><span class=\"l-Scalar-Plain\">base</span><span class=\"p-Indicator\">:</span>\n    <span class=\"s\">&#39;production&#39;</span><span class=\"p-Indicator\">:</span>\n        <span class=\"p-Indicator\">-</span> <span class=\"l-Scalar-Plain\">vim</span>\n</pre></div>\n<p>Note that <tt class=\"docutils literal\">sls</tt> files use <span class=\"caps\">YAML</span>&nbsp;syntax.</p>\n<p>Here we are installing vim in the production&nbsp;hostname.</p>\n<p>The <tt class=\"docutils literal\">salt/vim.sls</tt> file will look something like&nbsp;this:</p>\n<div class=\"highlight\"><pre><span class=\"l-Scalar-Plain\">vim</span><span class=\"p-Indicator\">:</span>\n    <span class=\"l-Scalar-Plain\">pkg</span><span class=\"p-Indicator\">:</span>\n        <span class=\"p-Indicator\">-</span> <span class=\"l-Scalar-Plain\">installed</span>\n</pre></div>\n<p>This simply says that we want the vim package installed.  Saltstack will\nautomatically detect your package manager (i.e. apt-get, yum,&nbsp;etc).</p>\n</div>\n<div class=\"section\" id=\"pillar\">\n<h2>Pillar</h2>\n<p>The <tt class=\"docutils literal\">pillar/top.sls</tt> file has the same structure as the main file from the\nsalt&nbsp;directory.</p>\n<div class=\"highlight\"><pre><span class=\"l-Scalar-Plain\">base</span><span class=\"p-Indicator\">:</span>\n    <span class=\"s\">&#39;production&#39;</span><span class=\"p-Indicator\">:</span>\n        <span class=\"p-Indicator\">-</span> <span class=\"l-Scalar-Plain\">production</span>\n</pre></div>\n<p>When the <tt class=\"docutils literal\">production</tt> hostname is detected, use the <tt class=\"docutils literal\">production.sls</tt> file\nfor configuration.  You can put just about anything you want to the\n<tt class=\"docutils literal\">production.sls</tt> file, be it the servers <span class=\"caps\">IP</span> address or the <span class=\"caps\">SMTP</span>&nbsp;settings.</p>\n</div>\n<div class=\"section\" id=\"where-to-put-things\">\n<h2>Where to put&nbsp;things</h2>\n<p>After you&#8217;ve installed Saltstack on your server, you should copy or symlink the\n<tt class=\"docutils literal\">salt/</tt> and <tt class=\"docutils literal\">pillar/</tt> directories to the <tt class=\"docutils literal\">/srv</tt> directory</p>\n<pre class=\"literal-block\">\n/srv/salt\n/srv/pillar\n</pre>\n</div>\n<div class=\"section\" id=\"running-it\">\n<h2>Running&nbsp;it</h2>\n<p>Once the configuration files are in place, you can run the minion&#8217;s\nprovisioning command to get everything configured and&nbsp;installed.</p>\n<pre class=\"literal-block\">\n$ salt-call --local state.highstate\n</pre>\n<p>Don&#8217;t ask me why it&#8217;s like this.  Makes no&nbsp;sense.</p>\n<p>Saltstack will run everything and then report what happened during the&nbsp;run.</p>\n</div>\n</div>\n", 
    "date_iso": "2013-12-11", 
    "title": "Masterless Saltstack", 
    "url": "/2013/12/masterless-saltstack", 
    "day": "11", 
    "categories": [
        {
            "name": "code", 
            "slug": "code"
        }, 
        {
            "name": "devops", 
            "slug": "devops"
        }
    ]
}